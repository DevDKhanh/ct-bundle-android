System.register("chunks:///_virtual/Banqi.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"fb79b+/wdpOMoF+Ye2yfzLL","Banqi",void 0);e("default",(function(e){const n="b",t="r",r=-1,o="p",i="c",s="r",l="n",u="b",c="a",f="k",a="xxxxkxxxx/9/1x5x1/x1x1x1x1x/9/9/X1X1X1X1X/1X5X1/9/XXXXKXXXX r - - 0 1",p=Object.freeze(["1-0","0-1","1/2-1/2","*"]),h=Object.freeze({b:[16,-1,1],r:[-16,-1,1]}),d=Object.freeze({c:[-16,16,-1,1],r:[-16,16,-1,1],n:[-33,-31,31,33,-18,14,-14,18],b:[-34,34,30,-30],a:[-17,17,15,-15],k:[-16,16,-1,1]}),b=Object.freeze({NORMAL:"n",CAPTURE:"c"}),g=Object.freeze({NORMAL:1,CAPTURE:2}),m=Object.freeze({a9:0,b9:1,c9:2,d9:3,e9:4,f9:5,g9:6,h9:7,i9:8,a8:16,b8:17,c8:18,d8:19,e8:20,f8:21,g8:22,h8:23,i8:24,a7:32,b7:33,c7:34,d7:35,e7:36,f7:37,g7:38,h7:39,i7:40,a6:48,b6:49,c6:50,d6:51,e6:52,f6:53,g6:54,h6:55,i6:56,a5:64,b5:65,c5:66,d5:67,e5:68,f5:69,g5:70,h5:71,i5:72,a4:80,b4:81,c4:82,d4:83,e4:84,f4:85,g4:86,h4:87,i4:88,a3:96,b3:97,c3:98,d3:99,e3:100,f3:101,g3:102,h3:103,i3:104,a2:112,b2:113,c2:114,d2:115,e2:116,f2:117,g2:118,h2:119,i2:120,a1:128,b1:129,c1:130,d1:131,e1:132,f1:133,g1:134,h1:135,i1:136,a0:144,b0:145,c0:146,d0:147,e0:148,f0:149,g0:150,h0:151,i0:152});let y=[],v=[],w="",x=!1;const k=Object.freeze({r:["a0","i0","a9","i9"],n:["b0","h0","b9","h9"],b:["c0","g0","c9","g9"],a:["d0","f0","d9","f9"],k:["e0","e9"],p:["a3","c3","e3","g3","i3","a6","c6","e6","g6","i6"],c:["b2","h2","b7","h7"]});function A(e){let n,t=0;for(let r=0;r<w.length;++r)if(n=w.charAt(r),"/"===n)t+=7;else if(le(n))t+=parseInt(n,10);else{if(t==e)return n.toLowerCase();t++}return n.toLowerCase()}const E=function(){const e={};for(const[n,t]of Object.entries(k))t.forEach((t=>{e[t]=n}));return e}();let C=new Array(256),R={r:r,b:r},N=t,T=0,_=1,q=[],O=[],$={};function j(e){void 0===e&&(e=!1),C=new Array(256),R={r:r,b:r},N=t,T=0,_=1,q=[],O=[],e||($={}),z(X())}function I(){P(a),v=[],y=[]}function P(e,r,o){void 0===o&&(o=!1);const i=L(e);if(!i.valid)throw new Error(`Invalid FEN: ${i.error}`);if(r){if(r&&!L(r).valid)throw new Error("Invalid random FEN provided");w=r}else w=(()=>{const e=["rnbakabnr","9","1c5c1","p1p1p1p1p","9","9","P1P1P1P1P","1C5C1","9","RNBAKABNR"],n=[],t=[],r={};e.forEach(((e,o)=>{e.split("").forEach(((e,i)=>{const s=`${o}-${i}`;"k"===e?r.black=s:"K"===e?r.red=s:e>="a"&&e<="z"?n.push(e):e>="A"&&e<="Z"&&t.push(e)}))}));const o=e=>{for(let n=e.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[e[n],e[t]]=[e[t],e[n]]}};o(n),o(t);let i=0,s=0;return e.map(((e,o)=>e.split("").map(((e,l)=>{const u=`${o}-${l}`;return u===r.black?"k":u===r.red?"K":e>="a"&&e<="z"?n[i++]:e>="A"&&e<="Z"?t[s++]:e})).join(""))).join("/")})();let s,l,u=e.split(/\s+/),c=u[0],f=0;j(o);try{for(let e=0;e<c.length;++e)s=c.charAt(e),"/"===s?f+=7:le(s)?f+=parseInt(s,10):(l=s<"a"?t:n,K({type:s.toLowerCase(),color:l,faceType:E[ie(f)]},ie(f)),f++)}catch(e){throw new Error(`Load failed: ${e.message}`)}return N=u[1]===n?n:t,T=parseInt(u[4],10),_=parseInt(u[5],10),z(X()),!0}function L(e){const r={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) should be '-'.",5:"3rd field (castling availability) should be '-'.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 10 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"1st field (piece positions) is invalid [each side has one king].",12:"1st field (piece positions) is invalid [each side has no more than 2 advisers].",13:"1st field (piece positions) is invalid [each side has no more than 2 bishops].",14:"1st field (piece positions) is invalid [each side has no more than 2 knights].",15:"1st field (piece positions) is invalid [each side has no more than 2 rooks].",16:"1st field (piece positions) is invalid [each side has no more than 2 cannons].",17:"1st field (piece positions) is invalid [each side has no more than 5 pawns].",18:"1st field (piece positions) is invalid [black king should at right position].",19:"1st field (piece positions) is invalid [red king should at right position].",20:"1st field (piece positions) is invalid [black adviser should at right position].",21:"1st field (piece positions) is invalid [red adviser should at right position].",22:"1st field (piece positions) is invalid [black bishop should at right position].",23:"1st field (piece positions) is invalid [red bishop should at right position].",24:"1st field (piece positions) is invalid [black pawn should at right position].",25:"1st field (piece positions) is invalid [red pawn should at right position]."};function o(e){return{valid:0===e,error_number:e,error:r[e]}}const i=e.split(/\s+/);if(6!==i.length)return o(1);if(isNaN(i[5])||parseInt(i[5],10)<=0)return o(2);if(isNaN(i[4])||parseInt(i[4],10)<0)return o(3);if(!/^-$/.test(i[3]))return o(4);if(!/^-$/.test(i[2]))return o(5);if(!/^([rwb])$/.test(i[1]))return o(6);const s=i[0].split("/");if(10!==s.length)return o(7);const l={p:{number:0,squares:[]},P:{number:0,squares:[]},c:{number:0,squares:[]},C:{number:0,squares:[]},r:{number:0,squares:[]},R:{number:0,squares:[]},n:{number:0,squares:[]},N:{number:0,squares:[]},b:{number:0,squares:[]},B:{number:0,squares:[]},a:{number:0,squares:[]},A:{number:0,squares:[]},k:{number:0,squares:[]},K:{number:0,squares:[]},x:{number:0,squares:[]},X:{number:0,squares:[]}};let u,c,a,p;for(u=0;u<s.length;u++){for(a=0,p=!1,c=0;c<s[u].length;c++)if(isNaN(s[u][c])){try{++l[s[u][c]].number}catch(e){return o(9)}l[s[u][c]].squares.push(u<<4|a),a+=1,p=!1}else{if(p)return o(8);a+=parseInt(s[u][c],10),p=!0}if(9!==a)return o(10)}return 1!==l.k.number||1!==l.K.number?o(11):l.a.number>2||l.A.number>2?o(12):l.b.number>2||l.B.number>2?o(13):l.n.number>2||l.N.number>2?o(14):l.r.number>2||l.R.number>2?o(15):l.c.number>2||l.C.number>2?o(16):l.p.number>5||l.P.number>5?o(17):ce(f,l.k.squares[0],n)?o(18):ce(f,l.K.squares[0],t)?o(19):o(0)}function X(){let e,n,r=0,o="";for(let i=m.a9;i<=m.i0;++i)null==C[i]?r++:(r>0&&(o+=r,r=0),e=C[i].color,n=C[i].type,o+=e===t?n.toUpperCase():n.toLowerCase()),oe(i)>=8&&(r>0&&(o+=r),i!==m.i0&&(o+="/"),r=0,i+=7);return[o,N,"-","-",T,_].join(" ")}function U(e){for(let n=0;n<e.length;n+=2)"string"==typeof e[n]&&"string"==typeof e[n+1]&&($[e[n]]=e[n+1]);return $}function z(e){q.length>0||(e!==a?$.FEN=e:delete $.FEN)}function K(e,n){if(!("type"in e)||!("color"in e))throw new Error("Invalid piece object (missing type/color)");const t="x"===e.type.toLowerCase()?e.faceType:e.type;if(-1==="pcrnbakPCRNBAK".indexOf(t.toLowerCase()))throw new Error(`Invalid piece type: ${e.type}`);if(!(n in m))throw new Error(`Invalid square: ${n}`);const o=m[n];if(e.type===f&&R[e.color]!==r&&R[e.color]!==o)throw new Error(`Invalid king placement at ${n}`);if("x"==e.type&&ce(t,o,e.color))throw new Error(`Invalid hidden piece placement at ${n}`);return C[o]={type:e.type,color:e.color,faceType:e.faceType},e.type===f&&(R[e.color]=o),z(X()),{ok:!0}}function F(e){const n=function(e){const n=C[m[e]];return n?{type:n.type,color:n.color,faceType:null==n?void 0:n.faceType}:null}(e);return C[m[e]]=null,n&&n.type===f&&(R[n.color]=r),z(X()),n}function B(e){function n(e,n,t,r,o){n.push(function(e,n,t,r){let o={color:N,from:n,to:t,flags:r,piece:e[n].type};return e[t]&&(o.captured=e[t].type,o.faceType=e[t].faceType),o}(e,t,r,o))}let r=[],a=N,p=se(a),b=m.a9,y=m.i0;const v=void 0===e||!("legal"in e)||e.legal,w=void 0!==e&&"opponent"in e&&e.opponent;if(void 0!==e&&"square"in e){if(!(e.square in m))return[];b=y=m[e.square]}let x,k,A,E,R,T,_,q,O;for(w&&(N=se(N),a=N,p=se(a)),x=b;x<=y;++x)if(E=C[x],null!=E&&E.color===a){for(O="x"==E.type?E.faceType:E.type,R=O===o?h[a]:d[O],k=0,A=R.length;k<A&&(!(O===o&&k>0)||($=x,a===t?re($)<5:re($)>4));++k)for(T=R[k],_=x,q=!1;!(_+=T,ue(_)||O===l&&fe(x,k)||O===u&&ae(x,k)||(O===c&&"x"==E.type||E.type===f)&&ce(O,_,a));){if(null==C[_]){if(O===i&&q)continue;n(C,r,x,_,g.NORMAL)}else{if(O!==i){C[_].color===p&&n(C,r,x,_,g.CAPTURE);break}if(q){C[_].color===p&&n(C,r,x,_,g.CAPTURE);break}q=!0}if(O!==i&&O!==s)break}oe(x)>=8&&(x+=7)}var $;if(!v)return r;let j=[];for(x=0,A=r.length;x<A;x++)Y(r[x]),Z(a)||j.push(r[x]),ee();return w&&(N=se(N)),j}function M(e,n){let t="";return t=ie(e.from)+ie(e.to),t}function S(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Z(e){let n,t,r,a=R[e],p=se(e);for(n=0,t=d.n.length;n<t;++n)if(r=a+d.n[n],null!=C[r]&&!ue(r)&&C[r].color===p&&C[r].type===l&&!fe(r,n<4?3-n:11-n))return!0;for(n=0,t=d.r.length;n<t;++n){let e=d.r[n],t=!1;for(r=a+e;!ue(r);r+=e){let e=C[r];if(null!=e){if(e.color===p)if(t){if(e.type===i)return!0}else if(e.type===s||e.type===f)return!0;if(t)break;t=!0}}}for(n=0,t=h[p].length;n<t;++n)if(r=a-h[p][n],null!=C[r]&&!ue(r)&&C[r].color===p&&C[r].type===o)return!0;for(n=0,t=d.a.length;n<t;++n)if(r=a+d.a[n],null!=C[r]&&C[r].color===p&&C[r].type===c)return!0;for(n=0,t=d.b.length;n<t;++n)if(r=a+d.b[n],null!=C[r]&&C[r].color===p&&C[r].type===u&&!ae(a,n))return!0;return!1}function G(){return Z(N)}function H(){return G()&&0===B().length}function D(){return!G()&&0===B().length}function Q(){let e,n,t={},r=0;for(let o in m)m.hasOwnProperty(o)&&(e=C[m[o]],e&&(n="x"===e.type?e.faceType:e.type,t[n]=n in t?t[n]+1:1,r++));return 2===r||void 0===t.n&&void 0===t.r&&void 0===t.c&&void 0===t.p}function V(){const e={};for(const n of v){const t=n.split(" ").slice(0,2).join(" ");if(e[t]=(e[t]||0)+1,e[t]>=8)return!0}return!1}function W(e,n){e.push({move:n,kings:{b:R.b,r:R.r},turn:N,half_moves:T,move_number:_})}function Y(e){W(q,e),null!=C[e.to]&&C[e.to].type===f&&(R[C[e.to].color]=r),C[e.to]=C[e.from],C[e.from]=null,C[e.to].type===f&&(R[C[e.to].color]=e.to),e.flags&g.CAPTURE?T=0:T++,N===n&&_++,N=se(N)}function J(e,n=!0){if(null==e)return null;const t=e.move;return R=e.kings,N=e.turn,T=e.half_moves,_=e.move_number,C[t.from]=C[t.to],C[t.from].type=t.piece,C[t.to]=null,(t.flags&g.CAPTURE)>0&&n&&(C[t.to]={type:t.captured,color:se(N),faceType:t.faceType}),t}function ee(){return J(q.pop())}function ne(){let e="   +---------------------------+\n";for(let n=m.a9;n<=m.i0;n++){if(0===oe(n)&&(e+=" "+"9876543210"[re(n)]+" |"),null==C[n])e+=" . ";else{let r=C[n].type;e+=" "+(C[n].color===t?null==r?void 0:r.toUpperCase():null==r?void 0:r.toLowerCase())+" "}8&n&&(e+="|\n",n+=7)}return e+="   +---------------------------+\n",e+="     a  b  c  d  e  f  g  h  i\n",e}function te(e,n){let t,r,o,i=S(e),s=i.match(/([a-iA-I][0-9])-?([a-iA-I][0-9])/);n&&s&&(t=s[1],r=s[2],o=s[3]);let l=B();for(let e=0,u=l.length;e<u;e++){if(i===S(M(l[e]))||n&&i===S(M(l[e])))return l[e];if(s&&(!t||t.toLowerCase()===l[e].piece)&&m[r]===l[e].from&&m[o]===l[e].to)return l[e]}return null}function re(e){return e>>4}function oe(e){return 15&e}function ie(e){const n=oe(e),t=re(e);return"abcdefghi".substring(n,n+1)+"9876543210".substring(t,t+1)}function se(e){return e===t?n:t}function le(e){return-1!=="0123456789".indexOf(e)}function ue(e){return e<0||re(e)>9||oe(e)>8}function ce(e,n,r){let i={};if(e===o)return i=[0,2,4,6,8],r===t?re(n)>6||re(n)>4&&-1===i.indexOf(oe(n)):re(n)<3||re(n)<5&&-1===i.indexOf(oe(n));if(e===u)i.r=[146,150,112,116,120,82,86],i.b=[2,6,32,36,40,66,70];else if(e===c)i.r=[147,149,132,115,117],i.b=[3,5,20,35,37];else{if(e!==f)return ue(n);i.r=[147,148,149,131,132,133,115,116,117],i.b=[3,4,5,19,20,21,35,36,37]}return-1===i[r].indexOf(n)}function fe(e,n){return null!=C[e+[-16,16,-1,1][Math.floor(n/2)]]}function ae(e,n){return null!=C[e+[-17,17,15,-15][n]]}function pe(e){let n=he(e);n.iccs=M(n),n.to=ie(n.to),n.from=ie(n.from),n.piece=N===t?n.piece.toUpperCase():n.piece;let r="";for(let e in g)(g[e]&n.flags)>0&&(r+=b[e]);return n.flags=r,n}function he(e){if("function"==typeof globalThis.structuredClone)return globalThis.structuredClone(e);if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((e=>he(e)));const n={};for(const t in e)n[t]=he(e[t]);return n}function de(e){return function(...n){if(x)throw new Error("Concurrent state mutation detected");try{return x=!0,e.apply(this,n)}finally{x=!1}}}function be(e){return e.replace(/^\s+|\s+$/g,"")}function ge(e){const n=B({legal:!1});let t=0;for(let r=0,o=n.length;r<o;r++){if(Y(n[r]),!Z(N))if(e-1>0){t+=ge(e-1)}else t++;ee()}return t}return P(void 0===e?a:e),{RED:t,BLACK:n,PAWN:o,CANNON:i,ROOK:s,KNIGHT:l,BISHOP:u,ADVISER:c,KING:f,SQUARES:function(){let e=[];for(let n=m.a9;n<=m.i0;n++)9!==oe(n)?e.push(ie(n)):n+=6;return e}(),FLAGS:b,load:de((function(e,...n){return P(e,...n)})),reset:de((function(){return I()})),moves:function(e){const n=B(e);let t=[];for(let r=0,o=n.length;r<o;r++)void 0!==e&&"verbose"in e&&e.verbose?t.push(pe(n[r])):t.push(M(n[r]));return t},in_check:function(){return G()},in_checkmate:function(){return H()},in_stalemate:function(){return D()},in_draw:function(){return T>=120||V()||Q()},insufficient_material:function(){return Q()},in_threefold_repetition:function(){return V()},game_over:function(){return T>=120||H()||D()||Q()||V()||R[se(N)]===r},validate_fen:function(e){return L(e)},fen:function(){return X()},board:function(){let e=[],n=[];for(let t=m.a9;t<=m.i0;t++)null==C[t]?n.push(null):n.push({type:C[t].type,color:C[t].color,faceType:C[t].faceType}),8&t&&(e.push(n),n=[],t+=7);return he(e)},pgn:function(e){let n,t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",r="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,o=[],i=!1;for(n in $)o.push("["+n+' "'+$[n]+'"]'+t),i=!0;i&&q.length&&o.push(t);let s=[];for(;q.length>0;)s.push(ee());let l=[],u="";for(;s.length>0;){let e=s.pop();q.length||"b"!==e.color?"b"!==e.color&&(u.length&&l.push(u),u=_+"."):u=_+". ...",u=u+" "+M(e),Y(e)}if(u.length&&l.push(u),void 0!==$.Result&&l.push($.Result),0===r)return o.join("")+l.join(" ");let c=0;for(n=0;n<l.length;n++)c+l[n].length>r&&0!==n?(" "===o[o.length-1]&&o.pop(),o.push(t),c=0):0!==n&&(o.push(" "),c++),o.push(l[n]),c+=l[n].length;return o.join("")},load_pgn:function(e,n){let t=void 0!==n&&"sloppy"in n&&n.sloppy;function r(e){return e.replace(/\\/g,"\\")}const o="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",i=new RegExp("^(?:\\s)*(((?:"+r(o)+")*\\[[^\\]]+\\])+)"),s=i.test(e)?i.exec(e)[1]:"";I();const l=function(e,n){let t="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",o={},i=e.split(new RegExp(r(t))),s="",l="";for(let e=0;e<i.length;e++)s=i[e].replace(/^\[([A-Z][A-Za-z]*)\s.*]$/,"$1"),l=i[e].replace(/^\[[A-Za-z]+\s"(.*)"]$/,"$1"),be(s).length>0&&(o[s]=l);return o}(s,n);for(let e in l)l.hasOwnProperty(e)&&U([e,l[e]]);"FEN"in l&&P(l.FEN,"",!0);let u=e.replace(s,"").replace(new RegExp(r(o),"g")," ");u=u.replace(/({[^}]+})+?/g,"");const c=/(\([^()]+\))+?/g;for(;c.test(u);)u=u.replace(c,"");u=u.replace(/\d+\.(\.\.)?/g,""),u=u.replace(/\.\.\./g,""),u=u.replace(/\$\d+/g,"");let f=be(u).split(new RegExp(/\s+/));f=f.join(",").replace(/,,+/g,",").split(",");let a="";for(let e=0;e<f.length-1;e++){if(a=te(f[e],t),null==a)return console.warn(`impossible move: ${f[e]}!\n${ne()}`),!1;Y(a)}if(a=f[f.length-1],p.indexOf(a)>-1)(function(e){for(let n in e)if(e.hasOwnProperty(n))return!0;return!1})($)&&void 0===$.Result&&U(["Result",a]);else{if(a=te(a,t),null==a)return console.warn(`impossible last move: ${f[f.length-1]}!\n${ne()}`),!1;Y(a)}return!0},header:function(){return U(arguments)},ascii:function(){return ne()},turn:function(){return N},move:de((function(e,n){const t=function(e,n){const t=void 0!==n&&"sloppy"in n&&n.sloppy;let r=null;if("string"==typeof e)r=te(e,t);else if("object"==typeof e){let n=B();for(let t=0,o=n.length;t<o;t++)if(e.from===ie(n[t].from)&&e.to===ie(n[t].to)&&!(""in n[t])){r=n[t];break}}if(!r)return null;const o=pe(r),i=C[r.from],s=C[r.to];if(i&&"x"==i.type&&(i.type=(null==n?void 0:n.type)??A(r.from)),s&&o.flags==b.CAPTURE){const e="x"===s.type?A(r.to):s.type;y.push({...s,realType:e})}return Y(r),O=[],v.push(X()),{...o,piece:i.type}}(e,n);return t?he(t):null})),undo:de((function(){W(O,null);const e=ee();if(e){const n=pe(e);return[e.from,e.to]=[e.to,e.from],O[O.length-1].move=e,he(n)}return O.pop(),null})),redo:de((function(){W(q,null);const e=J(O.pop(),!1);return e?([e.from,e.to]=[e.to,e.from],q[q.length-1].move=e,he(pe(e))):(q.pop(),null)})),clear:de((function(){return j()})),put:de((function(e,n){return K(e,n)})),remove:de((function(e){const n=F(e);return n?he(n):n})),perft:function(e){return ge(e)},pool_capture:function(){return he(y)},getHistory:function(){return q.map((e=>{const n=e.move;return{...he(n),from:ie(n.from),to:ie(n.to),piece:n.color===t?n.piece.toUpperCase():n.piece}}))},history:function(e){const n=void 0!==e&&"verbose"in e&&e.verbose;return he(q.map((e=>{const r=e.move;if(!n)return ie(r.from)+ie(r.to);const o={color:r.color,from:ie(r.from),to:ie(r.to),piece:r.color===t?r.piece.toUpperCase():r.piece,iccs:ie(r.from)+ie(r.to),captured:r.captured,faceType:r.faceType};let i="";for(const e in g)(r.flags&g[e])>0&&(i+=b[e]);return o.flags=i,o})))}}}));n._RF.pop()}}}));

System.register("chunks:///_virtual/CoUpLogic.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"b5811DFqqBNtKV8QX6qmG0z","CoUpLogic",void 0);e("default",(function(e){const n="b",t="r",r=-1,i="p",o="c",s="r",u="n",l="b",f="a",c="k",a="rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR r - - 0 1",p=Object.freeze(["1-0","0-1","1/2-1/2","*"]),h=Object.freeze({b:[16,-1,1],r:[-16,-1,1]}),d=Object.freeze({c:[-16,16,-1,1],r:[-16,16,-1,1],n:[-33,-31,31,33,-18,14,-14,18],b:[-34,34,30,-30],a:[-17,17,15,-15],k:[-16,16,-1,1]}),g=Object.freeze({NORMAL:"n",CAPTURE:"c"}),b=Object.freeze({NORMAL:1,CAPTURE:2}),m=Object.freeze({a9:0,b9:1,c9:2,d9:3,e9:4,f9:5,g9:6,h9:7,i9:8,a8:16,b8:17,c8:18,d8:19,e8:20,f8:21,g8:22,h8:23,i8:24,a7:32,b7:33,c7:34,d7:35,e7:36,f7:37,g7:38,h7:39,i7:40,a6:48,b6:49,c6:50,d6:51,e6:52,f6:53,g6:54,h6:55,i6:56,a5:64,b5:65,c5:66,d5:67,e5:68,f5:69,g5:70,h5:71,i5:72,a4:80,b4:81,c4:82,d4:83,e4:84,f4:85,g4:86,h4:87,i4:88,a3:96,b3:97,c3:98,d3:99,e3:100,f3:101,g3:102,h3:103,i3:104,a2:112,b2:113,c2:114,d2:115,e2:116,f2:117,g2:118,h2:119,i2:120,a1:128,b1:129,c1:130,d1:131,e1:132,f1:133,g1:134,h1:135,i1:136,a0:144,b0:145,c0:146,d0:147,e0:148,f0:149,g0:150,h0:151,i0:152});let v=new Array(256),y={r:r,b:r},q=t,w=0,A=1,N=[],R=[],k={};function _(e){void 0===e&&(e=!1),v=new Array(256),y={r:r,b:r},q=t,w=0,A=1,N=[],R=[],e||(k={}),x(E())}function C(){O(a)}function O(e,r){if(void 0===r&&(r=!1),!P(e).valid)return!1;let i,o,s=e.split(/\s+/),u=s[0],l=0;_(r);for(let e=0;e<u.length;++e)i=u.charAt(e),"/"===i?l+=7:-1!=="0123456789".indexOf(i)?l+=parseInt(i,10):(o=i<"a"?t:n,I({type:i.toLowerCase(),color:o},J(l)),l++);return q=s[1]===n?n:t,w=parseInt(s[4],10),A=parseInt(s[5],10),x(E()),!0}function P(e){const r={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) should be '-'.",5:"3rd field (castling availability) should be '-'.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 10 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"1st field (piece positions) is invalid [each side has one king].",12:"1st field (piece positions) is invalid [each side has no more than 2 advisers].",13:"1st field (piece positions) is invalid [each side has no more than 2 bishops].",14:"1st field (piece positions) is invalid [each side has no more than 2 knights].",15:"1st field (piece positions) is invalid [each side has no more than 2 rooks].",16:"1st field (piece positions) is invalid [each side has no more than 2 cannons].",17:"1st field (piece positions) is invalid [each side has no more than 5 pawns].",18:"1st field (piece positions) is invalid [black king should at right position].",19:"1st field (piece positions) is invalid [red king should at right position].",20:"1st field (piece positions) is invalid [black adviser should at right position].",21:"1st field (piece positions) is invalid [red adviser should at right position].",22:"1st field (piece positions) is invalid [black bishop should at right position].",23:"1st field (piece positions) is invalid [red bishop should at right position].",24:"1st field (piece positions) is invalid [black pawn should at right position].",25:"1st field (piece positions) is invalid [red pawn should at right position]."};function o(e){return{valid:0===e,error_number:e,error:r[e]}}const s=e.split(/\s+/);if(6!==s.length)return o(1);if(isNaN(s[5])||parseInt(s[5],10)<=0)return o(2);if(isNaN(s[4])||parseInt(s[4],10)<0)return o(3);if(!/^-$/.test(s[3]))return o(4);if(!/^-$/.test(s[2]))return o(5);if(!/^([rwb])$/.test(s[1]))return o(6);const u=s[0].split("/");if(10!==u.length)return o(7);const a={p:{number:0,squares:[]},P:{number:0,squares:[]},c:{number:0,squares:[]},C:{number:0,squares:[]},r:{number:0,squares:[]},R:{number:0,squares:[]},n:{number:0,squares:[]},N:{number:0,squares:[]},b:{number:0,squares:[]},B:{number:0,squares:[]},a:{number:0,squares:[]},A:{number:0,squares:[]},k:{number:0,squares:[]},K:{number:0,squares:[]}};let p,h,d,g;for(p=0;p<u.length;p++){for(d=0,g=!1,h=0;h<u[p].length;h++)if(isNaN(u[p][h])){try{++a[u[p][h]].number}catch(e){return o(9)}a[u[p][h]].squares.push(p<<4|d),d+=1,g=!1}else{if(g)return o(8);d+=parseInt(u[p][h],10),g=!0}if(9!==d)return o(10)}if(1!==a.k.number||1!==a.K.number)return o(11);if(a.a.number>2||a.A.number>2)return o(12);if(a.b.number>2||a.B.number>2)return o(13);if(a.n.number>2||a.N.number>2)return o(14);if(a.r.number>2||a.R.number>2)return o(15);if(a.c.number>2||a.C.number>2)return o(16);if(a.p.number>5||a.P.number>5)return o(17);if(te(c,a.k.squares[0],n))return o(18);if(te(c,a.K.squares[0],t))return o(19);for(p=0;p<a.a.squares.length;++p)if(te(f,a.a.squares[p],n))return o(20);for(p=0;p<a.A.squares.length;++p)if(te(f,a.A.squares[p],t))return o(21);for(p=0;p<a.b.squares.length;++p)if(te(l,a.b.squares[p],n))return o(22);for(p=0;p<a.B.squares.length;++p)if(te(l,a.B.squares[p],t))return o(23);for(p=0;p<a.p.squares.length;++p)if(te(i,a.p.squares[p],n))return o(24);for(p=0;p<a.P.squares.length;++p)if(te(i,a.P.squares[p],t))return o(25);return o(0)}function E(){let e,n,r=0,i="";for(let o=m.a9;o<=m.i0;++o)null==v[o]?r++:(r>0&&(i+=r,r=0),e=v[o].color,n=v[o].type,i+=e===t?n.toUpperCase():n.toLowerCase()),X(o)>=8&&(r>0&&(i+=r),o!==m.i0&&(i+="/"),r=0,o+=7);return[i,q,"-","-",w,A].join(" ")}function j(e){for(let n=0;n<e.length;n+=2)"string"==typeof e[n]&&"string"==typeof e[n+1]&&(k[e[n]]=e[n+1]);return k}function x(e){N.length>0||(e!==a?k.FEN=e:delete k.FEN)}function $(e){const n=v[m[e]];return n?{type:n.type,color:n.color}:null}function I(e,n){if(!("type"in e)||!("color"in e))return!1;if(-1==="pcrnbakPCRNBAK".indexOf(e.type.toLowerCase()))return!1;if(!(n in m))return!1;const t=m[n];return(e.type!==c||y[e.color]===r||y[e.color]===t)&&(!te(e.type,t,e.color)&&(v[t]={type:e.type,color:e.color},e.type===c&&(y[e.color]=t),x(E()),!0))}function L(e){function n(e,n,t,r,i){n.push(function(e,n,t,r){let i={color:q,from:n,to:t,flags:r,piece:e[n].type};return e[t]&&(i.captured=e[t].type),i}(e,t,r,i))}let t=[],r=q,a=Y(r),p=m.a9,g=m.i0;const y=void 0===e||!("legal"in e)||e.legal,w=void 0!==e&&"opponent"in e&&e.opponent;if(void 0!==e&&"square"in e){if(!(e.square in m))return[];p=g=m[e.square]}let A,N,R,k,_,C,O,P;for(w&&(q=Y(q),r=q,a=Y(r)),A=p;A<=g;++A)if(k=v[A],null!=k&&k.color===r){for(_=k.type===i?h[r]:d[k.type],N=0,R=_.length;N<R&&(!(k.type===i&&N>0)||ee(A,r));++N)for(C=_[N],O=A,P=!1;!(O+=C,ne(O)||k.type===u&&re(A,N)||k.type===l&&(ie(A,N)||ee(O,r))||(k.type===f||k.type===c)&&te(k.type,O,r));){if(null==v[O]){if(k.type===o&&P)continue;n(v,t,A,O,b.NORMAL)}else{if(k.type!==o){v[O].color===a&&n(v,t,A,O,b.CAPTURE);break}if(P){v[O].color===a&&n(v,t,A,O,b.CAPTURE);break}P=!0}if(k.type!==o&&k.type!==s)break}X(A)>=8&&(A+=7)}if(!y)return t;let E=[];for(A=0,R=t.length;A<R;A++)D(t[A]),F(r)||E.push(t[A]),H();return w&&(q=Y(q)),E}function U(e,n){let t="";return t=J(e.from)+J(e.to),t}function B(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function F(e){let n,t,r,l=y[e],f=Y(e);for(n=0,t=d.n.length;n<t;++n)if(r=l+d.n[n],null!=v[r]&&!ne(r)&&v[r].color===f&&v[r].type===u&&!re(r,n<4?3-n:11-n))return!0;for(n=0,t=d.r.length;n<t;++n){let e=d.r[n],t=!1;for(r=l+e;!ne(r);r+=e){let e=v[r];if(null!=e){if(e.color===f)if(t){if(e.type===o)return!0}else if(e.type===s||e.type===c)return!0;if(t)break;t=!0}}}for(n=0,t=h[f].length;n<t;++n)if(r=l-h[f][n],null!=v[r]&&!ne(r)&&v[r].color===f&&v[r].type===i)return!0;return!1}function K(){return F(q)}function z(){return K()&&0===L().length}function T(){return!K()&&0===L().length}function S(){let e,n={},t=0;for(let r in m)m.hasOwnProperty(r)&&(e=v[m[r]],e&&(n[e.type]=e.type in n?n[e.type]+1:1,t++));return 2===t||void 0===n.n&&void 0===n.r&&void 0===n.c&&void 0===n.p}function G(){let e,n=[],t={},r=!1;for(;e=H(),e;)n.push(e);for(;;){let e=E().split(" ").slice(0,2).join(" ");if(t[e]=e in t?t[e]+1:1,t[e]>=3&&(r=!0),!n.length)break;D(n.pop())}return r}function M(e,n){e.push({move:n,kings:{b:y.b,r:y.r},turn:q,half_moves:w,move_number:A})}function D(e){M(N,e),null!=v[e.to]&&v[e.to].type===c&&(y[v[e.to].color]=r),v[e.to]=v[e.from],v[e.from]=null,v[e.to].type===c&&(y[v[e.to].color]=e.to),e.flags&b.CAPTURE?w=0:w++,q===n&&A++,q=Y(q)}function Z(e,n=!0){if(null==e)return null;const t=e.move;return y=e.kings,q=e.turn,w=e.half_moves,A=e.move_number,v[t.from]=v[t.to],v[t.from].type=t.piece,v[t.to]=null,(t.flags&b.CAPTURE)>0&&n&&(v[t.to]={type:t.captured,color:Y(q)}),t}function H(){return Z(N.pop())}function Q(){let e="   +---------------------------+\n";for(let n=m.a9;n<=m.i0;n++){if(0===X(n)&&(e+=" "+"9876543210"[W(n)]+" |"),null==v[n])e+=" . ";else{let r=v[n].type;e+=" "+(v[n].color===t?r.toUpperCase():r.toLowerCase())+" "}8&n&&(e+="|\n",n+=7)}return e+="   +---------------------------+\n",e+="     a  b  c  d  e  f  g  h  i\n",e}function V(e,n){let t,r,i,o=B(e),s=o.match(/([a-iA-I][0-9])-?([a-iA-I][0-9])/);n&&s&&(t=s[1],r=s[2],i=s[3]);let u=L();for(let e=0,l=u.length;e<l;e++){if(o===B(U(u[e]))||n&&o===B(U(u[e])))return u[e];if(s&&(!t||t.toLowerCase()===u[e].piece)&&m[r]===u[e].from&&m[i]===u[e].to)return u[e]}return null}function W(e){return e>>4}function X(e){return 15&e}function J(e){const n=X(e),t=W(e);return"abcdefghi".substring(n,n+1)+"9876543210".substring(t,t+1)}function Y(e){return e===t?n:t}function ee(e,n){return n===t?W(e)<5:W(e)>4}function ne(e){return e<0||W(e)>9||X(e)>8}function te(e,n,r){let o={};if(e===i)return o=[0,2,4,6,8],r===t?W(n)>6||W(n)>4&&-1===o.indexOf(X(n)):W(n)<3||W(n)<5&&-1===o.indexOf(X(n));if(e===l)o.r=[146,150,112,116,120,82,86],o.b=[2,6,32,36,40,66,70];else if(e===f)o.r=[147,149,132,115,117],o.b=[3,5,20,35,37];else{if(e!==c)return ne(n);o.r=[147,148,149,131,132,133,115,116,117],o.b=[3,4,5,19,20,21,35,36,37]}return-1===o[r].indexOf(n)}function re(e,n){return null!=v[e+[-16,16,-1,1][Math.floor(n/2)]]}function ie(e,n){return null!=v[e+[-17,17,15,-15][n]]}function oe(e){let n=se(e);n.iccs=U(n),n.to=J(n.to),n.from=J(n.from),n.piece=q===t?n.piece.toUpperCase():n.piece;let r="";for(let e in b)(b[e]&n.flags)>0&&(r+=g[e]);return n.flags=r,n}function se(e){let n=e instanceof Array?[]:{};for(let t in e)n[t]="object"==typeof t?se(e[t]):e[t];return n}function ue(e){return e.replace(/^\s+|\s+$/g,"")}function le(e){const n=L({legal:!1});let t=0;for(let r=0,i=n.length;r<i;r++){if(D(n[r]),!F(q))if(e-1>0){t+=le(e-1)}else t++;H()}return t}return O(void 0===e?a:e),{RED:t,BLACK:n,PAWN:i,CANNON:o,ROOK:s,KNIGHT:u,BISHOP:l,ADVISER:f,KING:c,SQUARES:function(){let e=[];for(let n=m.a9;n<=m.i0;n++)9!==X(n)?e.push(J(n)):n+=6;return e}(),FLAGS:g,load:function(e){return O(e)},reset:function(){return C()},moves:function(e){const n=L(e);let t=[];for(let r=0,i=n.length;r<i;r++)void 0!==e&&"verbose"in e&&e.verbose?t.push(oe(n[r])):t.push(U(n[r]));return t},in_check:function(){return K()},in_checkmate:function(){return z()},in_stalemate:function(){return T()},in_draw:function(){return w>=120||G()||S()},insufficient_material:function(){return S()},in_threefold_repetition:function(){return G()},game_over:function(){return w>=120||z()||T()||S()||G()||y[Y(q)]===r},validate_fen:function(e){return P(e)},fen:function(){return E()},board:function(){let e=[],n=[];for(let t=m.a9;t<=m.i0;t++)null==v[t]?n.push(null):n.push({type:v[t].type,color:v[t].color}),8&t&&(e.push(n),n=[],t+=7);return e},pgn:function(e){let n,t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",r="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,i=[],o=!1;for(n in k)i.push("["+n+' "'+k[n]+'"]'+t),o=!0;o&&N.length&&i.push(t);let s=[];for(;N.length>0;)s.push(H());let u=[],l="";for(;s.length>0;){let e=s.pop();N.length||"b"!==e.color?"b"!==e.color&&(l.length&&u.push(l),l=A+"."):l=A+". ...",l=l+" "+U(e),D(e)}if(l.length&&u.push(l),void 0!==k.Result&&u.push(k.Result),0===r)return i.join("")+u.join(" ");let f=0;for(n=0;n<u.length;n++)f+u[n].length>r&&0!==n?(" "===i[i.length-1]&&i.pop(),i.push(t),f=0):0!==n&&(i.push(" "),f++),i.push(u[n]),f+=u[n].length;return i.join("")},load_pgn:function(e,n){let t=void 0!==n&&"sloppy"in n&&n.sloppy;function r(e){return e.replace(/\\/g,"\\")}const i="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",o=new RegExp("^(?:\\s)*(((?:"+r(i)+")*\\[[^\\]]+\\])+)"),s=o.test(e)?o.exec(e)[1]:"";C();const u=function(e,n){let t="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",i={},o=e.split(new RegExp(r(t))),s="",u="";for(let e=0;e<o.length;e++)s=o[e].replace(/^\[([A-Z][A-Za-z]*)\s.*]$/,"$1"),u=o[e].replace(/^\[[A-Za-z]+\s"(.*)"]$/,"$1"),ue(s).length>0&&(i[s]=u);return i}(s,n);for(let e in u)u.hasOwnProperty(e)&&j([e,u[e]]);if("FEN"in u&&!O(u.FEN,!0))return console.warn("load header FEN failed!"),!1;let l=e.replace(s,"").replace(new RegExp(r(i),"g")," ");l=l.replace(/({[^}]+})+?/g,"");const f=/(\([^()]+\))+?/g;for(;f.test(l);)l=l.replace(f,"");l=l.replace(/\d+\.(\.\.)?/g,""),l=l.replace(/\.\.\./g,""),l=l.replace(/\$\d+/g,"");let c=ue(l).split(new RegExp(/\s+/));c=c.join(",").replace(/,,+/g,",").split(",");let a="";for(let e=0;e<c.length-1;e++){if(a=V(c[e],t),null==a)return console.warn(`impossible move: ${c[e]}!\n${Q()}`),!1;D(a)}if(a=c[c.length-1],p.indexOf(a)>-1)(function(e){for(let n in e)if(e.hasOwnProperty(n))return!0;return!1})(k)&&void 0===k.Result&&j(["Result",a]);else{if(a=V(a,t),null==a)return console.warn(`impossible last move: ${c[c.length-1]}!\n${Q()}`),!1;D(a)}return!0},header:function(){return j(arguments)},ascii:function(){return Q()},turn:function(){return q},move:function(e,n){const t=void 0!==n&&"sloppy"in n&&n.sloppy;let r=null;if("string"==typeof e)r=V(e,t);else if("object"==typeof e){let n=L();for(let t=0,i=n.length;t<i;t++)if(e.from===J(n[t].from)&&e.to===J(n[t].to)&&!(""in n[t])){r=n[t];break}}if(!r)return null;const i=oe(r);return D(r),R=[],i},undo:function(){M(R,null);const e=H();if(e){const n=oe(e);return[e.from,e.to]=[e.to,e.from],R[R.length-1].move=e,n}return R.pop(),null},redo:function(){M(N,null);const e=Z(R.pop(),!1);return e?([e.from,e.to]=[e.to,e.from],N[N.length-1].move=e,oe(e)):(N.pop(),null)},clear:function(){return _()},put:function(e,n){return I(e,n)},get:function(e){return $(e)},remove:function(e){return function(e){const n=$(e);return v[m[e]]=null,n&&n.type===c&&(y[n.color]=r),x(E()),n}(e)},perft:function(e){return le(e)},history:function(e){let n=[],t=[],r=void 0!==e&&"verbose"in e&&e.verbose;for(;N.length>0;)n.push(H());for(;n.length>0;){let e=n.pop();r?t.push(oe(e)):t.push(U(e)),D(e)}return t}}}));n._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIBase.ts","./KKTileCoTuongWidget.ts","./KKPieceWidget.ts","./kk.ts","./GameCoTuongData.ts","./SocketIO.ts","./SocketEvent.ts","./Xiangqi.ts","./MessageEvent.ts","./AudioPath.ts","./Banqi.ts"],(function(e){var i,t,n,o,s,r,c,a,l,h,u,d,g,f,p,P,v,b,m,T,y,w,A,C,q;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.initializerDefineProperty},function(e){n=e.cclegacy,o=e.Node,s=e.Prefab,r=e.sp,c=e._decorator,a=e.NodePool,l=e.instantiate},function(e){h=e.UIBase},function(e){u=e.KKTileCoTuongWidget},function(e){d=e.KKPieceWidget,g=e.Side,f=e.PieceType},function(e){p=e.default},function(e){P=e.default},function(e){v=e.default},function(e){b=e.SocketEvent,m=e.typeSocket,T=e.actionID},function(e){y=e.default},function(e){w=e.MessageEventType},function(e){A=e.randomSound,C=e.AudioPath},function(e){q=e.default}],execute:function(){var M,_,x,I,k,E,D,S,B,K,L,$,z,H,F,O,R,G,U,N;n._RF.push({},"c6e4c6GH8VGhrliUjszojDw","GameManager",void 0);const{ccclass:Q,property:W}=c;e("GameManager",(M=Q("GameManager"),_=W(o),x=W([s]),I=W(s),k=W(s),E=W(r.Skeleton),D=W(r.Skeleton),S=W(r.Skeleton),B=W(d),M(((N=class e extends h{constructor(...e){super(...e),t(this,"container",$,this),t(this,"piecePrefabs",z,this),t(this,"piecePrefab",H,this),t(this,"tilePrefab",F,this),t(this,"chieuTuong",O,this),t(this,"batDau",R,this),t(this,"anQuan",G,this),this.xiangqi=null,this.isBanqi=!1,t(this,"selectedPiece",U,this),this.board=[],this.isPlay=!1,this.isCanReload=!1,this.piecePool=new a,this.tilePool=new a,this.pieceManager=[]}static get instance(){return this._instance}get currentTurn(){return"r"===this.xiangqi.turn()?g.RED:g.BLACK}initGame(e){e?(this.isBanqi=!0,this.xiangqi=q()):this.xiangqi=y()}putToPiecePool(e){this.piecePool.put(e)}getBoard(){return this.board}onLoad(){p.eventMgr.on(w.ON_SELECT_TILE,this.onSelectPiece,this),p.eventMgr.on(w.ON_MOVE_PIECE,this.onMove,this),p.eventMgr.on(w.PUT_TO_POOL,this.putToPiecePool,this),p.eventMgr.on(w.SHOW_HISTORY,this.showHistory,this),v.on(b.makeMove,(e=>{e&&(console.log("Nhận dữ liệu di chuyển từ server:",e),this.movePieceToTile(e),P.fen=null==e?void 0:e.fen),this.selectedPiece&&(this.selectedPiece.unActive(),this.selectedPiece=null)})),e._instance||(e._instance=this),this.initPiecePool(32),this.initTilePool(90)}onDestroy(){e._instance=null,super.onDestroy(),v.off(b.makeMove),p.eventMgr.offTargetAll(this),this.piecePool.clear(),this.tilePool.clear()}initPiecePool(e){for(let i=0;i<e;i++){const e=l(this.piecePrefab);this.piecePool.put(e)}}initTilePool(e){for(let i=0;i<e;i++){const e=l(this.tilePrefab);this.tilePool.put(e)}}createBoard(e=g.RED){this.xiangqi.load(P.fen),this.board=[];for(let i=0;i<10;i++){const t=[];for(let n=0;n<9;n++){let o,s,r;o=this.tilePool.size()>0?this.tilePool.get():l(this.tilePrefab),e===g.BLACK?(s=116*(8-n)-484+20,r=116*(9-i)-527):(s=116*n-484+20,r=116*i-527),o.setPosition(s,r);const c=o.getComponent(u);c&&c.init(i,n),o.name=`${i}_${n}`,this.container.addChild(o),t.push(o)}this.board.push(t)}console.log("CREATE BOARD")}setupPieces(){var e;const i=null==(e=this.xiangqi)?void 0:e.board();if(i)for(let e=0;e<i.length;e++)for(let t=0;t<i[e].length;t++){const n=i[e][t];if(null===n)continue;const o=n.type,s="r"===n.color?g.RED:g.BLACK,r=9-e,c=t;this.placePiece(o,s,r,c)}}placePiece(e,i,t,n){let o;o=this.piecePool.size()>0?this.piecePool.get():l(this.piecePrefab);const s=o.getComponent(d);s&&(s.name=`${f[e]}_${g[i]}`,s.init(t,n,e,i),s.unActive(),this.board[t]&&this.board[t][n]?this.board[t][n].addChild(o):console.error(`Board index lỗi: row ${t}, col ${n}`),this.pieceManager.push(s))}resetBoard(){if(this.isPlay){this.isPlay=!1,this.selectedPiece=null,this.pieceManager=[];for(let e=0;e<this.board.length;e++)for(let i=0;i<this.board[e].length;i++){const t=this.board[e][i];if(!t)continue;const n=t.getComponentInChildren(d);n&&(n.node.removeFromParent(),this.piecePool.put(n.node));const o=t.getComponent(u);o&&(o.hide(),o.hideHistory()),t.removeFromParent(),this.tilePool.put(t)}this.board=[]}}onSelectPiece(e){var i,t,n,o;if(p.eventMgr.emit(w.HIDE_TILE),!e)return console.warn("Quân cờ không tồn tại"),void(null==(t=this.selectedPiece)||t.unActive());if(P.side!==this.currentTurn)return console.log("Không thể chọn quân cờ: không đúng lượt"),void(null==(n=this.selectedPiece)||n.unActive());if(this.selectedPiece&&this.selectedPiece.side!==e.side)return void console.log("Không thể chọn quân cờ của đối phương");if(this.currentTurn!==e.side||this.selectedPiece===e)return console.log("Không phải lượt của bạn",e,this.currentTurn),null==(o=this.selectedPiece)||o.unActive(),void(this.selectedPiece=null);const s=this.convertToAscii(e.row,e.col);let r;try{r=this.xiangqi?this.xiangqi.moves({square:s,verbose:!0}):[]}catch(e){return void console.error("Lỗi tính toán nước đi:",e)}null==(i=this.selectedPiece)||i.unActive(),this.selectedPiece=e,this.selectedPiece.active(),console.log("Chọn quân cờ:",e.name,"với nước đi:",s,r),r.forEach((i=>{const{row:t,col:n}=this.convertFromAscii(i.to),o=this.board[t]&&this.board[t][n]?this.board[t][n].getComponent(u):null;if(!o)return;const s=this.board[t][n].getComponentInChildren(d);s&&s.side!==e.side&&(o.activeAttack(),o.node.setSiblingIndex(100)),o.active()}))}startGame(e,i){this.isPlay||(i&&(this.batDau.node.active=!0,this.batDau.setAnimation(0,"animation",!1),A(C.effect,"giaophong",!0,!1),A(C.effect,"start",!0,!1)),this.isPlay=!0,this.board=[],this.createBoard(e),this.setupPieces())}onMove(e){if(!this.selectedPiece||e.pos.col===this.selectedPiece.col&&e.pos.row===this.selectedPiece.row)return;const i=`${this.convertToAscii(this.selectedPiece.row,this.selectedPiece.col)}${this.convertToAscii(e.pos.row,e.pos.col)}`;v.reqAsync(b.actions,{type:this.isBanqi?m.coUp:m.coTuong,actionID:T.makeMove,roomId:P.id,move:i})}movePieceToTile(e){if(!e)return;const i=this.convertFromAscii(e.from),t=this.convertFromAscii(e.to);let n;try{n=!!this.xiangqi&&this.xiangqi.move(`${e.from}${e.to}`,{type:null==e?void 0:e.piece})}catch(e){return void console.error("Lỗi di chuyển từ server:",e)}if(!n)return void console.log("Không thể di chuyển");"c"!==e.flags||this.xiangqi.in_check()||(this.anQuan.node.active=!0,this.anQuan.setAnimation(0,"animation",!1),A(C.effect,"anquan",!0,!1));const o=this.board[i.row]?this.board[i.row][i.col]:null;if(!o)return;const s=o.getComponentInChildren(d),r=this.board[t.row]?this.board[t.row][t.col]:null;s&&r&&(this.movePiece(s,r.getComponent(u)),this.isBanqi&&s.show(e.piece))}async movePiece(e,i){if(e&&i){await e.onMovePiece(i);try{const e=!!this.xiangqi&&this.xiangqi.in_check(),i=!!this.xiangqi&&this.xiangqi.in_draw(),t=!!this.xiangqi&&this.xiangqi.game_over();i?console.log("Hòa"):e&&(this.chieuTuong.node.active=!0,t?(this.chieuTuong.setAnimation(0,"chieubi",!1),A(C.effect,"chieubi",!0,!1)):(this.chieuTuong.setAnimation(0,"chieutuong",!1),A(C.effect,"chieu",!0,!1)))}catch(e){console.error("Lỗi khi kiểm tra trạng thái game:",e)}}}showHistory(){var e;p.eventMgr.emit(w.HIDE_TILE_HISTORY);const i=null==(e=this.xiangqi)?void 0:e.getHistory();if(!this.xiangqi||i.length<=0)return;const t=i.pop();if(!t)return;const n=this.convertFromAscii(t.from),o=this.convertFromAscii(t.to),s=this.board[n.row]?this.board[n.row][n.col]:null,r=this.board[o.row]?this.board[o.row][o.col]:null;if(!s||!r)return;const c=s.getComponent(u),a=r.getComponent(u);c&&c.showFrom(),a&&a.showTo()}getPiece(e,i){return this.pieceManager.find((t=>t.type===e&&t.side===i))}convertToAscii(e,i){return`${String.fromCharCode(65+i)}${e}`.toLowerCase()}convertFromAscii(e){const i=e.toUpperCase().match(/^([A-I])(\d)$/);if(!i)return console.error(`Định dạng ASCII không hợp lệ: ${e}`),{row:-1,col:-1};const[,t,n]=i,o=t.charCodeAt(0)-65;return{row:parseInt(n),col:o}}isMyTurn(){return P.side==this.currentTurn}})._instance=null,$=i((L=N).prototype,"container",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=i(L.prototype,"piecePrefabs",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),H=i(L.prototype,"piecePrefab",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=i(L.prototype,"tilePrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=i(L.prototype,"chieuTuong",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=i(L.prototype,"batDau",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=i(L.prototype,"anQuan",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=i(L.prototype,"selectedPiece",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=L))||K));n._RF.pop()}}}));

System.register("chunks:///_virtual/KKBanCoPanel.ts",["cc","./UIBase.ts","./GameManager.ts"],(function(n){var a,e,t,c;return{setters:[function(n){a=n.cclegacy,e=n._decorator},function(n){t=n.UIBase},function(n){c=n.GameManager}],execute:function(){var s;a._RF.push({},"e5e62OVw9NKtZEJwIwAZj9H","KKBanCoPanel",void 0);const{ccclass:o,property:i}=e;n("KKBanCoPanel",o("KKBanCoPanel")(s=class extends t{onEnable(){var n;c.instance.initGame(null==(n=this.recvData)?void 0:n.isBanqi)}onBtnClick(n,a){}})||s);a._RF.pop()}}}));

System.register("chunks:///_virtual/KKCauHoaPopup.ts",["cc","./PopupBase.ts","./SocketEvent.ts","./SocketIO.ts","./GameManager.ts"],(function(t){var o,c,e,n,a,s,u,i;return{setters:[function(t){o=t.cclegacy,c=t._decorator},function(t){e=t.PopupBase},function(t){n=t.typeSocket,a=t.SocketEvent,s=t.actionID},function(t){u=t.default},function(t){i=t.GameManager}],execute:function(){var p;o._RF.push({},"d8931MLgOhOgJ07RHEmi8Vh","KKCauHoaPopup",void 0);const{ccclass:r,property:k}=c;t("KKCauHoaPopup",r("KKCauHoaPopup")(p=class extends e{onBtnClick(t,o){const c=i.instance.isBanqi?n.coUp:n.coTuong;switch(o){case"ok":case"no":u.reqAsync(a.actions,{type:c,actionID:s.peaceAnswer,isOk:"ok"==o}),this.close()}}})||p);o._RF.pop()}}}));

System.register("chunks:///_virtual/KKCoTuongBundle",["./Banqi.ts","./CoUpLogic.ts","./GameManager.ts","./KKBanCoPanel.ts","./KKCauHoaPopup.ts","./KKCoTuongLayer.ts","./KKEndGamePopup.ts","./KKMenuPopup.ts","./KKPieceWidget.ts","./KKTileCoTuongWidget.ts","./Xiangqi.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/KKCoTuongLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LayerBase.ts","./kk.ts","./KKGameUIConf.ts","./SocketIO.ts","./SocketEvent.ts","./GameCoTuongData.ts","./GameData.ts","./SpriteNumber.ts","./CocosHelper.ts","./GameManager.ts","./KKEndGamePopup.ts","./KKUtils.ts","./KKAvatarWidget.ts","./AsyncHelper.ts","./LabelEllipsis.ts"],(function(e){var t,i,o,n,a,s,r,l,u,c,h,d,p,y,f,m,g,w,b,v,C,T,P,E,K,D,R,L,A;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){o=e.cclegacy,n=e.Node,a=e.Label,s=e._decorator},function(e){r=e.LayerBase},function(e){l=e.default},function(e){u=e.KKCoTuongPopupConf,c=e.KKCoTuongPanelConf,h=e.KKHomePopupConf,d=e.KKLayerConf},function(e){p=e.default},function(e){y=e.SocketEvent,f=e.typeSocket,m=e.actionID},function(e){g=e.default,w=e.RoomStatus,b=e.Side},function(e){v=e.default},function(e){C=e.SpriteNumber},function(e){T=e.secondsToMinute,P=e.coin},function(e){E=e.GameManager},function(e){K=e.EFFECT},function(e){D=e.default},function(e){R=e.KKAvatarWidget},function(e){L=e.default},function(e){A=e.EllipsisLabel}],execute:function(){var N,I,k,G,O,M,F,S,B,V,z,H,W,j,x,q,U,_,Y,Z,J,Q,X;o._RF.push({},"3c0e2tHY49ARKWZ03Oj047/","KKCoTuongLayer",void 0);const{ccclass:$,property:ee}=s;e("KKCoTuongLayer",(N=$("KKCoTuongLayer"),I=ee(n),k=ee(A),G=ee(A),O=ee(n),M=ee(n),F=ee({type:[n],displayName:"Ảnh chữ sẵn sàng",tooltip:"[0] => Me; [1] => Other Player"}),S=ee({type:[a],displayName:"Lable hiển thị thời gian",tooltip:"[0] => Me; [1] => Other Player"}),B=ee({type:[a],displayName:"Lable hiển thị elo",tooltip:"[0] => Me; [1] => Other Player"}),V=ee({type:[R],displayName:"Sprite hiển thị thời gian",tooltip:"[0] => Me; [1] => Other Player"}),z=ee(C),N((j=t((W=class extends r{constructor(...e){super(...e),i(this,"otherPlayer",j,this),i(this,"otherName",x,this),i(this,"myName",q,this),i(this,"controller",U,this),i(this,"waiting",_,this),i(this,"spReady",Y,this),i(this,"lbTimes",Z,this),i(this,"lbElo",J,this),i(this,"spCountdown",Q,this),i(this,"time",X,this),this.isShowEffect=!1}onLoad(){var e,t;this.time=this.getObj("controller.time",C),g.isLeaveRoom=!1,g.isViewer=null==(e=this.recvData)?void 0:e.isViewer,g.id=null==(t=this.recvData)?void 0:t.roomID}async start(){var e;g.isViewer||(p.on(y.peace,(()=>{l.uiMgr.showPopupAsync(u.CauHoa)})),p.on(y.messageCoTuong,(e=>{D.showToast(e)})),p.on(y.peaceAnswer,(()=>{this.showEnd(K.hoa),this.spCountdown[0].startFill(0,!1),this.spCountdown[1].startFill(0,!1)}))),p.on(y.startGame,(()=>{var e;null==E||null==(e=E.instance)||e.resetBoard()})),p.reqAsync(y.actions,{type:f.coTuong,actionID:m.joinRoom,roomID:null==(e=this.recvData)?void 0:e.roomID}),p.on(y.dataRoom,(async e=>{if(!(e.id!=g.id&&null!=g&&g.id||g.isLeaveRoom))try{var t;if(e)if(this.waiting.active=e.status==w.WAITING&&!g.isViewer,e.fen&&(g.fen=e.fen),g.isViewer)g.setData(e),this.updateInfoPlayerForViewer();else if(null!=e&&null!=(t=e.players)&&t.some((e=>(null==e?void 0:e.id)==v.info.id))?(g.setData(e),this.updateLayer()):(g.leaveRoom(),this.goBackHome()),null!=e&&e.loser){const t=e.loser.id==v.info.id;if(l.uiMgr.getPopup(u.EndGame)||this.isShowEffect)return;this.isShowEffect=!0,await L.sleepAsync(.8),t?this.showEnd(K.thua):this.showEnd(K.thang),this.spCountdown[0].startFill(0,!1),this.spCountdown[1].startFill(0,!1)}}catch(e){g.leaveRoom(),this.goBackHome()}})),p.on(y.countDown,(async e=>{var t;if(e.id!=g.id&&null!=g&&g.id)return;const i=null==e||null==(t=e.players)?void 0:t.find((e=>e.isReady&&e.id==v.info.id));this.time&&(this.time.value=e.countdown),g.isViewer||(e.status!=w.COUNTDOWN?this.controller.active=!1:this.controller.active=!i),e.status==w.PLAYING?this.updatePlaying(e):e.status!=w.COUNTDOWN&&e.status!=w.WAITING||(this.waiting.active=e.status==w.WAITING)}));const t=this.getObj("ban"),i=await l.uiMgr.createPanelAsync(c.BanCo);t.addChild(i),this.getObj("menu.btn-hoa").active=!g.isViewer,this.getObj("menu.btn-doi").active=g.isViewer}onDestroy(){p.off(y.dataRoom),p.off(y.peace),p.off(y.peaceAnswer),p.off(y.countDown),p.off(y.messageCoTuong),p.off(y.startGame)}showEnd(e){var t,i,o;l.uiMgr.showPopupAsync(u.EndGame,{effect:e,name:(null==(t=g.cloneOtherPlayer)?void 0:t.displayname)??(null==(i=g.cloneOtherPlayer)?void 0:i.username),elo:null==(o=g.cloneOtherPlayer)?void 0:o.elo})}updatePlaying(e){if(g.isViewer){const t=null==e?void 0:e.playerTime[g.side],i=null==e?void 0:e.playerTime[g.side==b.RED?b.BLACK:b.RED];this.lbTimes[0].string=T(t||0),this.lbTimes[1].string=T(i||0),E.instance.startGame(g.side,!0),this.spCountdown[0].startFill(e.countdown,g.side==e.currentTurn),this.spCountdown[1].startFill(e.countdown,g.side!=e.currentTurn),this.isShowEffect=!1}else{const t=e.players.find((e=>e.id==v.info.id)),i=null==e?void 0:e.playerTime[t.side],o=null==e?void 0:e.playerTime[t.side==b.RED?b.BLACK:b.RED];this.lbTimes[0].string=T(i||0),this.lbTimes[1].string=T(o||0),g.side=t.side,E.instance.startGame(t.side,!0),this.spCountdown[0].startFill(e.countdown,t.side==e.currentTurn),this.spCountdown[1].startFill(e.countdown,t.side!=e.currentTurn),this.isShowEffect=!1}}updateInfoPlayerForViewer(){const e=g.players.find((e=>e.side==g.side)),t=g.players.find((e=>e.side!=g.side));var i,o;e&&(this.myName.setLabelText(e.displayname??e.username),this.lbElo[0].string=P(e.elo),null==(i=this.spCountdown[0])||i.init(e.elo));t?(this.otherPlayer.active=!0,this.otherName.setLabelText(t.displayname??t.username),this.lbElo[1].string=P(t.elo),null==(o=this.spCountdown[1])||o.init(t.elo)):this.otherPlayer.active=!1;this.spReady.forEach((e=>{e.active=!1}))}updateLayer(){var e,t,i,o;g.otherPlayer?(this.otherPlayer.active=!0,this.otherName.setLabelText(g.otherPlayer.displayname??g.otherPlayer.username),this.lbElo[1].string=P(null==(t=g.otherPlayer)?void 0:t.elo),null==(i=this.spCountdown[1])||i.init(null==(o=g.otherPlayer)?void 0:o.elo)):this.otherPlayer.active=!1;this.myName.setLabelText(v.info.displayName??v.info.username),this.lbElo[0].string=P(v.getElo()),null==(e=this.spCountdown[0])||e.init(v.getElo()),this.checkReady()}checkReady(){g.players.forEach((e=>{e.id==v.info.id?this.spReady[0].active=e.isReady:this.spReady[1].active=e.isReady}))}async onBtnClick(e,t){switch(t){case"menu":await l.uiMgr.showPopupAsync(u.Menu);break;case"change":g.side=g.side==b.RED?b.BLACK:b.RED,E.instance.resetBoard(),E.instance.startGame(g.side),this.updateInfoPlayerForViewer();break;case"cauhoa":p.reqAsync(y.actions,{type:f.coTuong,actionID:m.peace});break;case"ready":this.controller.active=!1,p.reqAsync(y.actions,{type:f.coTuong,actionID:m.readyRoom});break;case"help":l.uiMgr.showPopupAsync(h.Help)}}goBackHome(){p.reqAsync(y.actions,{type:f.coTuong,actionID:m.leaveRoom}),l.uiMgr.goLayerAsync(d.Home)}}).prototype,"otherPlayer",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=t(W.prototype,"otherName",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=t(W.prototype,"myName",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=t(W.prototype,"controller",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=t(W.prototype,"waiting",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y=t(W.prototype,"spReady",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Z=t(W.prototype,"lbTimes",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),J=t(W.prototype,"lbElo",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=t(W.prototype,"spCountdown",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),X=t(W.prototype,"time",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=W))||H));o._RF.pop()}}}));

System.register("chunks:///_virtual/KKEndGamePopup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupBase.ts","./KKAvatarWidget.ts","./GameData.ts","./AudioPath.ts"],(function(e){var t,i,n,a,o,r,l,s,u,c,h,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){n=e.cclegacy,a=e.sp,o=e.Label,r=e._decorator,l=e.Color},function(e){s=e.PopupBase},function(e){u=e.KKAvatarWidget},function(e){c=e.default},function(e){h=e.randomSound,f=e.AudioPath}],execute:function(){var p,m,d,g,b,v,y,E,K,D,P,A,w;n._RF.push({},"31c1cUP4alArZNs2lRhilTf","KKEndGamePopup",void 0);let N=e("EFFECT",function(e){return e.hoa="hoa",e.thang="thang",e.thua="thua",e}({}));const{ccclass:z,property:L}=r;e("KKEndGamePopup",(p=z("KKEndGamePopup"),m=L(a.Skeleton),d=L(u),g=L(o),b=L(o),v=L(o),p((K=t((E=class extends s{constructor(...e){super(...e),i(this,"effect",K,this),i(this,"otherAvatar",D,this),i(this,"myName",P,this),i(this,"otherName",A,this),i(this,"elo",w,this),this.timer=null}onLoad(){var e,t;void 0!==c.changedElo&&(this.recvData.effect==N.thang?h(f.effect,"win",!0,!1):this.recvData.effect==N.thua?h(f.effect,"lose",!0,!1):h(f.effect,"draw",!0,!1),this.effect.setAnimation(0,this.recvData.effect,!1),this.enableClickBlankToClose(),this.timer=setTimeout((()=>{this.close()}),3700),this.myName.string=c.info.displayname??c.info.username,this.otherName.string=null==(e=this.recvData)?void 0:e.name,this.otherAvatar.init(null==(t=this.recvData)?void 0:t.elo),this.elo.string=`ELO: ${c.changedElo>=0?`+${c.changedElo}`:c.changedElo}`,this.elo.color=c.changedElo>0?l.YELLOW:l.WHITE)}onDestroy(){clearTimeout(this.timer),super.onDestroy()}}).prototype,"effect",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(E.prototype,"otherAvatar",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(E.prototype,"myName",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(E.prototype,"otherName",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(E.prototype,"elo",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=E))||y));n._RF.pop()}}}));

System.register("chunks:///_virtual/KKMenuPopup.ts",["cc","./PopupBase.ts","./kk.ts","./KKGameUIConf.ts","./SocketEvent.ts","./SocketIO.ts","./GameCoTuongData.ts","./GameManager.ts"],(function(e){var t,n,a,c,o,s,i,u,r,p,l;return{setters:[function(e){t=e.cclegacy,n=e._decorator},function(e){a=e.PopupBase},function(e){c=e.default},function(e){o=e.KKLayerConf},function(e){s=e.typeSocket,i=e.SocketEvent,u=e.actionID},function(e){r=e.default},function(e){p=e.default},function(e){l=e.GameManager}],execute:function(){var h;t._RF.push({},"1eb514UINlNr7RQndgpfvOM","KKMenuPopup",void 0);const{ccclass:f,property:k}=n;e("KKMenuPopup",f("KKMenuPopup")(h=class extends a{onLoad(){this.enableClickBlankToClose()}start(){this.getObj("khung.menu.cau-hoa").active=!p.isViewer,this.getObj("khung.menu.xin-thua").active=!p.isViewer}onBtnClick(e,t){const n=l.instance.isBanqi?s.coUp:s.coTuong;switch(t){case"dong":this.close();break;case"thoat":r.reqAsync(i.actions,{type:n,actionID:u.leaveRoom}),p.leaveRoom(),c.uiMgr.goLayerAsync(o.Home);break;case"cauhoa":r.reqAsync(i.actions,{type:n,actionID:u.peace}),this.close();break;case"xinthua":r.reqAsync(i.actions,{type:n,actionID:u.surrender}),this.close();break;case"tatieng":case"tatnhac":this.close()}}})||h);t._RF.pop()}}}));

System.register("chunks:///_virtual/KKPieceWidget.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIBase.ts","./AudioPath.ts","./SkinManager.ts","./kk.ts","./MessageEvent.ts"],(function(e){var t,i,n,o,r,s,a,c,l,u,p,d,h,g,f,y,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){n=e.cclegacy,o=e.Enum,r=e.Sprite,s=e.Label,a=e._decorator,c=e.UITransform,l=e.tween,u=e.Vec3,p=e.Color},function(e){d=e.UIBase},function(e){h=e.randomSound,g=e.AudioPath},function(e){f=e.GameType},function(e){y=e.default},function(e){b=e.MessageEventType}],execute:function(){var m,v,O,T,P,w,E,N,S,C,A,I,K;n._RF.push({},"16e85RIKa5Dd7QtgUCAiYFj","KKPieceWidget",void 0);const{ccclass:D,property:k}=a;let M=e("PieceType",function(e){return e.TUONG="k",e.SI="a",e.TINH="b",e.XE="r",e.PHAO="c",e.MA="n",e.TOT="p",e.NONE="x",e}({})),R=e("Side",function(e){return e[e.RED=0]="RED",e[e.BLACK=1]="BLACK",e}({}));e("KKPieceWidget",(m=D("KKPieceWidget"),v=k({type:o(M)}),O=k({type:o(R)}),T=k(r),P=k(s),m((N=t((E=class e extends d{constructor(...e){super(...e),i(this,"type",N,this),i(this,"side",S,this),i(this,"sp",C,this),i(this,"row",A,this),i(this,"col",I,this),i(this,"lbCount",K,this)}init(e,t,i,n){this.row=e,this.col=t,this.type=i,this.side=n,this.updateSprite()}updateSprite(){const e=this.side===R.RED?"red":"black",t=y.skinsMgr.getSkinManager(f.COTUONG);if(this.type!==M.TUONG&&this.type==M.NONE)return void(this.sp.spriteFrame=t.getAssetsBySkinId(e,M.NONE));this.getComponentInChildren(r).spriteFrame=t.getAssetsBySkinId(e,this.type)}async onMovePiece(t){const i=t.node.getComponentInChildren(e);i&&(i.node.removeFromParent(),y.eventMgr.emit(b.PUT_TO_POOL,i.node));const n=t.node.getWorldPosition(),o=this.node.parent.getComponent(c);if(!o)return void console.error("Không tìm thấy UITransform trên parent");const r=o.convertToNodeSpaceAR(n);await new Promise((e=>{l(this.node).to(.2,{position:r},{easing:"sineOut"}).call((()=>{this.node.parent=t.node,this.node.setPosition(u.ZERO),h(g.effect,"piece",!0,!1),this.row=t.pos.row,this.col=t.pos.col,y.eventMgr.emit(b.SHOW_HISTORY),e()})).start()}))}show(e,t,i){void 0!==t&&(this.side=t),!isNaN(null==i?void 0:i.count)&&(null==i?void 0:i.count)>1?(this.lbCount.string=null==i?void 0:i.count.toString(),this.lbCount.node.parent.active=!0):this.lbCount.node.parent.active=!1,(null==i?void 0:i.type)==M.NONE&&null!=i&&i.realType?this.sp.color=new p("ADADAD"):this.sp.color=p.WHITE,this.type=e,this.updateSprite()}active(){this.sp.color=p.YELLOW}unActive(){this.sp.color=p.WHITE}}).prototype,"type",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return M.TUONG}}),S=t(E.prototype,"side",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return R.RED}}),C=t(E.prototype,"sp",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=t(E.prototype,"row",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I=t(E.prototype,"col",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),K=t(E.prototype,"lbCount",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=E))||w));n._RF.pop()}}}));

System.register("chunks:///_virtual/KKTileCoTuongWidget.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIBase.ts","./KKPieceWidget.ts","./kk.ts","./MessageEvent.ts","./GameCoTuongData.ts"],(function(t){var e,i,o,n,r,s,a,c,l,u,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){o=t.cclegacy,n=t.CCInteger,r=t.Node,s=t._decorator},function(t){a=t.UIBase},function(t){c=t.KKPieceWidget},function(t){l=t.default},function(t){u=t.MessageEventType},function(t){h=t.default}],execute:function(){var p,g,f,d,v,y,b,m,T,w,C,I,K,E,_;o._RF.push({},"2893eH5wkpIK4mi8YTsHRA2","KKTileCoTuongWidget",void 0);const{ccclass:k,property:M,type:H}=s;t("KKTileCoTuongWidget",(p=k("KKTileCoTuongWidget"),g=M(n),f=M(n),d=M({type:r}),v=M({type:r}),y=M({type:r}),b=M({type:r}),p((w=e((T=class extends a{constructor(...t){super(...t),i(this,"row",w,this),i(this,"col",C,this),i(this,"position",I,this),i(this,"attack",K,this),i(this,"from",E,this),i(this,"to",_,this)}onLoad(){l.eventMgr.on(u.HIDE_TILE,this.hide,this),l.eventMgr.on(u.HIDE_TILE_HISTORY,this.hideHistory,this)}onDestroy(){l.eventMgr.offTargetAll(this)}get pos(){return{row:this.row,col:this.col}}get piece(){return this.node.getComponentInChildren(c)}init(t,e){this.row=t,this.col=e}activeAttack(){this.attack.active=!0}active(){this.position.active=!0}showFrom(){this.from.active=!0}showTo(){this.to.active=!0}hide(){this.position.active=!1,this.attack.active=!1}hideHistory(){this.from.active=!1,this.to.active=!1}onBtnClick(t,e){if(!h.isViewer)switch(e){case"move":const t=this.node.getComponentInChildren(c);l.eventMgr.emit(u.ON_SELECT_TILE,t),l.eventMgr.emit(u.ON_MOVE_PIECE,this)}}}).prototype,"row",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=e(T.prototype,"col",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I=e(T.prototype,"position",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(T.prototype,"attack",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(T.prototype,"from",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(T.prototype,"to",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=T))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/Xiangqi.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"114657O5BRIh61V3YJDFVX+","Xiangqi",void 0);e("default",(function(e){console.log("Xiangqi init");const n="b",t="r",r=-1,i="p",o="c",s="r",u="n",l="b",f="a",c="k",a="rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR r - - 0 1",p=Object.freeze(["1-0","0-1","1/2-1/2","*"]),h=Object.freeze({b:[16,-1,1],r:[-16,-1,1]}),d=Object.freeze({c:[-16,16,-1,1],r:[-16,16,-1,1],n:[-33,-31,31,33,-18,14,-14,18],b:[-34,34,30,-30],a:[-17,17,15,-15],k:[-16,16,-1,1]}),g=Object.freeze({NORMAL:"n",CAPTURE:"c"}),b=Object.freeze({NORMAL:1,CAPTURE:2}),m=Object.freeze({a9:0,b9:1,c9:2,d9:3,e9:4,f9:5,g9:6,h9:7,i9:8,a8:16,b8:17,c8:18,d8:19,e8:20,f8:21,g8:22,h8:23,i8:24,a7:32,b7:33,c7:34,d7:35,e7:36,f7:37,g7:38,h7:39,i7:40,a6:48,b6:49,c6:50,d6:51,e6:52,f6:53,g6:54,h6:55,i6:56,a5:64,b5:65,c5:66,d5:67,e5:68,f5:69,g5:70,h5:71,i5:72,a4:80,b4:81,c4:82,d4:83,e4:84,f4:85,g4:86,h4:87,i4:88,a3:96,b3:97,c3:98,d3:99,e3:100,f3:101,g3:102,h3:103,i3:104,a2:112,b2:113,c2:114,d2:115,e2:116,f2:117,g2:118,h2:119,i2:120,a1:128,b1:129,c1:130,d1:131,e1:132,f1:133,g1:134,h1:135,i1:136,a0:144,b0:145,c0:146,d0:147,e0:148,f0:149,g0:150,h0:151,i0:152});let v=new Array(256),y={r:r,b:r},q=t,w=0,A=1,R=[],k=[],N={};function _(e){void 0===e&&(e=!1),v=new Array(256),y={r:r,b:r},q=t,w=0,A=1,R=[],k=[],e||(N={}),x(E())}function O(){C(a)}function C(e,r){if(void 0===r&&(r=!1),!P(e).valid)return!1;let i,o,s=e.split(/\s+/),u=s[0],l=0;_(r);for(let e=0;e<u.length;++e)i=u.charAt(e),"/"===i?l+=7:-1!=="0123456789".indexOf(i)?l+=parseInt(i,10):(o=i<"a"?t:n,I({type:i.toLowerCase(),color:o},W(l)),l++);return q=s[1]===n?n:t,w=parseInt(s[4],10),A=parseInt(s[5],10),x(E()),!0}function P(e){const r={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) should be '-'.",5:"3rd field (castling availability) should be '-'.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 10 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"1st field (piece positions) is invalid [each side has one king].",12:"1st field (piece positions) is invalid [each side has no more than 2 advisers].",13:"1st field (piece positions) is invalid [each side has no more than 2 bishops].",14:"1st field (piece positions) is invalid [each side has no more than 2 knights].",15:"1st field (piece positions) is invalid [each side has no more than 2 rooks].",16:"1st field (piece positions) is invalid [each side has no more than 2 cannons].",17:"1st field (piece positions) is invalid [each side has no more than 5 pawns].",18:"1st field (piece positions) is invalid [black king should at right position].",19:"1st field (piece positions) is invalid [red king should at right position].",20:"1st field (piece positions) is invalid [black adviser should at right position].",21:"1st field (piece positions) is invalid [red adviser should at right position].",22:"1st field (piece positions) is invalid [black bishop should at right position].",23:"1st field (piece positions) is invalid [red bishop should at right position].",24:"1st field (piece positions) is invalid [black pawn should at right position].",25:"1st field (piece positions) is invalid [red pawn should at right position]."};function o(e){return{valid:0===e,error_number:e,error:r[e]}}const s=e.split(/\s+/);if(6!==s.length)return o(1);if(isNaN(s[5])||parseInt(s[5],10)<=0)return o(2);if(isNaN(s[4])||parseInt(s[4],10)<0)return o(3);if(!/^-$/.test(s[3]))return o(4);if(!/^-$/.test(s[2]))return o(5);if(!/^([rwb])$/.test(s[1]))return o(6);const u=s[0].split("/");if(10!==u.length)return o(7);const a={p:{number:0,squares:[]},P:{number:0,squares:[]},c:{number:0,squares:[]},C:{number:0,squares:[]},r:{number:0,squares:[]},R:{number:0,squares:[]},n:{number:0,squares:[]},N:{number:0,squares:[]},b:{number:0,squares:[]},B:{number:0,squares:[]},a:{number:0,squares:[]},A:{number:0,squares:[]},k:{number:0,squares:[]},K:{number:0,squares:[]}};let p,h,d,g;for(p=0;p<u.length;p++){for(d=0,g=!1,h=0;h<u[p].length;h++)if(isNaN(u[p][h])){try{++a[u[p][h]].number}catch(e){return o(9)}a[u[p][h]].squares.push(p<<4|d),d+=1,g=!1}else{if(g)return o(8);d+=parseInt(u[p][h],10),g=!0}if(9!==d)return o(10)}if(1!==a.k.number||1!==a.K.number)return o(11);if(a.a.number>2||a.A.number>2)return o(12);if(a.b.number>2||a.B.number>2)return o(13);if(a.n.number>2||a.N.number>2)return o(14);if(a.r.number>2||a.R.number>2)return o(15);if(a.c.number>2||a.C.number>2)return o(16);if(a.p.number>5||a.P.number>5)return o(17);if(te(c,a.k.squares[0],n))return o(18);if(te(c,a.K.squares[0],t))return o(19);for(p=0;p<a.a.squares.length;++p)if(te(f,a.a.squares[p],n))return o(20);for(p=0;p<a.A.squares.length;++p)if(te(f,a.A.squares[p],t))return o(21);for(p=0;p<a.b.squares.length;++p)if(te(l,a.b.squares[p],n))return o(22);for(p=0;p<a.B.squares.length;++p)if(te(l,a.B.squares[p],t))return o(23);for(p=0;p<a.p.squares.length;++p)if(te(i,a.p.squares[p],n))return o(24);for(p=0;p<a.P.squares.length;++p)if(te(i,a.P.squares[p],t))return o(25);return o(0)}function E(){let e,n,r=0,i="";for(let o=m.a9;o<=m.i0;++o)null==v[o]?r++:(r>0&&(i+=r,r=0),e=v[o].color,n=v[o].type,i+=e===t?n.toUpperCase():n.toLowerCase()),Q(o)>=8&&(r>0&&(i+=r),o!==m.i0&&(i+="/"),r=0,o+=7);return[i,q,"-","-",w,A].join(" ")}function j(e){for(let n=0;n<e.length;n+=2)"string"==typeof e[n]&&"string"==typeof e[n+1]&&(N[e[n]]=e[n+1]);return N}function x(e){R.length>0||(e!==a?N.FEN=e:delete N.FEN)}function $(e){const n=v[m[e]];return n?{type:n.type,color:n.color}:null}function I(e,n){if(!("type"in e)||!("color"in e))return!1;if(-1==="pcrnbakPCRNBAK".indexOf(e.type.toLowerCase()))return!1;if(!(n in m))return!1;const t=m[n];return(e.type!==c||y[e.color]===r||y[e.color]===t)&&(!te(e.type,t,e.color)&&(v[t]={type:e.type,color:e.color},e.type===c&&(y[e.color]=t),x(E()),!0))}function U(e){function n(e,n,t,r,i){n.push(function(e,n,t,r){let i={color:q,from:n,to:t,flags:r,piece:e[n].type};return e[t]&&(i.captured=e[t].type),i}(e,t,r,i))}let t=[],r=q,a=Y(r),p=m.a9,g=m.i0;const y=void 0===e||!("legal"in e)||e.legal,w=void 0!==e&&"opponent"in e&&e.opponent;if(void 0!==e&&"square"in e){if(!(e.square in m))return[];p=g=m[e.square]}let A,R,k,N,_,O,C,P;for(w&&(q=Y(q),r=q,a=Y(r)),A=p;A<=g;++A)if(N=v[A],null!=N&&N.color===r){for(_=N.type===i?h[r]:d[N.type],R=0,k=_.length;R<k&&(!(N.type===i&&R>0)||ee(A,r));++R)for(O=_[R],C=A,P=!1;!(C+=O,ne(C)||N.type===u&&re(A,R)||N.type===l&&(ie(A,R)||ee(C,r))||(N.type===f||N.type===c)&&te(N.type,C,r));){if(null==v[C]){if(N.type===o&&P)continue;n(v,t,A,C,b.NORMAL)}else{if(N.type!==o){v[C].color===a&&n(v,t,A,C,b.CAPTURE);break}if(P){v[C].color===a&&n(v,t,A,C,b.CAPTURE);break}P=!0}if(N.type!==o&&N.type!==s)break}Q(A)>=8&&(A+=7)}if(!y)return t;let E=[];for(A=0,k=t.length;A<k;A++)D(t[A]),L(r)||E.push(t[A]),H();return w&&(q=Y(q)),E}function B(e,n){let t="";return t=W(e.from)+W(e.to),t}function F(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function L(e){let n,t,r,l=y[e],f=Y(e);for(n=0,t=d.n.length;n<t;++n)if(r=l+d.n[n],null!=v[r]&&!ne(r)&&v[r].color===f&&v[r].type===u&&!re(r,n<4?3-n:11-n))return!0;for(n=0,t=d.r.length;n<t;++n){let e=d.r[n],t=!1;for(r=l+e;!ne(r);r+=e){let e=v[r];if(null!=e){if(e.color===f)if(t){if(e.type===o)return!0}else if(e.type===s||e.type===c)return!0;if(t)break;t=!0}}}for(n=0,t=h[f].length;n<t;++n)if(r=l-h[f][n],null!=v[r]&&!ne(r)&&v[r].color===f&&v[r].type===i)return!0;return!1}function K(){return L(q)}function z(){return K()&&0===U().length}function T(){return!K()&&0===U().length}function S(){let e,n={},t=0;for(let r in m)m.hasOwnProperty(r)&&(e=v[m[r]],e&&(n[e.type]=e.type in n?n[e.type]+1:1,t++));return 2===t||void 0===n.n&&void 0===n.r&&void 0===n.c&&void 0===n.p}function M(){let e,n=[],t={},r=!1;for(;e=H(),e;)n.push(e);for(;;){let e=E().split(" ").slice(0,2).join(" ");if(t[e]=e in t?t[e]+1:1,t[e]>=8&&(r=!0),!n.length)break;D(n.pop())}return r}function X(e,n){e.push({move:n,kings:{b:y.b,r:y.r},turn:q,half_moves:w,move_number:A})}function D(e){X(R,e),null!=v[e.to]&&v[e.to].type===c&&(y[v[e.to].color]=r),v[e.to]=v[e.from],v[e.from]=null,v[e.to].type===c&&(y[v[e.to].color]=e.to),e.flags&b.CAPTURE?w=0:w++,q===n&&A++,q=Y(q)}function G(e,n=!0){if(null==e)return null;const t=e.move;return y=e.kings,q=e.turn,w=e.half_moves,A=e.move_number,v[t.from]=v[t.to],v[t.from].type=t.piece,v[t.to]=null,(t.flags&b.CAPTURE)>0&&n&&(v[t.to]={type:t.captured,color:Y(q)}),t}function H(){return G(R.pop())}function V(){let e="   +---------------------------+\n";for(let n=m.a9;n<=m.i0;n++){if(0===Q(n)&&(e+=" "+"9876543210"[J(n)]+" |"),null==v[n])e+=" . ";else{let r=v[n].type;e+=" "+(v[n].color===t?r.toUpperCase():r.toLowerCase())+" "}8&n&&(e+="|\n",n+=7)}return e+="   +---------------------------+\n",e+="     a  b  c  d  e  f  g  h  i\n",e}function Z(e,n){let t,r,i,o=F(e),s=o.match(/([a-iA-I][0-9])-?([a-iA-I][0-9])/);n&&s&&(t=s[1],r=s[2],i=s[3]);let u=U();for(let e=0,l=u.length;e<l;e++){if(o===F(B(u[e]))||n&&o===F(B(u[e])))return u[e];if(s&&(!t||t.toLowerCase()===u[e].piece)&&m[r]===u[e].from&&m[i]===u[e].to)return u[e]}return null}function J(e){return e>>4}function Q(e){return 15&e}function W(e){const n=Q(e),t=J(e);return"abcdefghi".substring(n,n+1)+"9876543210".substring(t,t+1)}function Y(e){return e===t?n:t}function ee(e,n){return n===t?J(e)<5:J(e)>4}function ne(e){return e<0||J(e)>9||Q(e)>8}function te(e,n,r){let o={};if(e===i)return o=[0,2,4,6,8],r===t?J(n)>6||J(n)>4&&-1===o.indexOf(Q(n)):J(n)<3||J(n)<5&&-1===o.indexOf(Q(n));if(e===l)o.r=[146,150,112,116,120,82,86],o.b=[2,6,32,36,40,66,70];else if(e===f)o.r=[147,149,132,115,117],o.b=[3,5,20,35,37];else{if(e!==c)return ne(n);o.r=[147,148,149,131,132,133,115,116,117],o.b=[3,4,5,19,20,21,35,36,37]}return-1===o[r].indexOf(n)}function re(e,n){return null!=v[e+[-16,16,-1,1][Math.floor(n/2)]]}function ie(e,n){return null!=v[e+[-17,17,15,-15][n]]}function oe(e){let n=se(e);n.iccs=B(n),n.to=W(n.to),n.from=W(n.from),n.piece=q===t?n.piece.toUpperCase():n.piece;let r="";for(let e in b)(b[e]&n.flags)>0&&(r+=g[e]);return n.flags=r,n}function se(e){let n=e instanceof Array?[]:{};for(let t in e)n[t]="object"==typeof t?se(e[t]):e[t];return n}function ue(e){return e.replace(/^\s+|\s+$/g,"")}function le(e){const n=U({legal:!1});let t=0;for(let r=0,i=n.length;r<i;r++){if(D(n[r]),!L(q))if(e-1>0){t+=le(e-1)}else t++;H()}return t}return C(void 0===e?a:e),{RED:t,BLACK:n,PAWN:i,CANNON:o,ROOK:s,KNIGHT:u,BISHOP:l,ADVISER:f,KING:c,SQUARES:function(){let e=[];for(let n=m.a9;n<=m.i0;n++)9!==Q(n)?e.push(W(n)):n+=6;return e}(),FLAGS:g,load:function(e){return C(e)},reset:function(){return O()},moves:function(e){const n=U(e);let t=[];for(let r=0,i=n.length;r<i;r++)void 0!==e&&"verbose"in e&&e.verbose?t.push(oe(n[r])):t.push(B(n[r]));return t},in_check:function(){return K()},in_checkmate:function(){return z()},in_stalemate:function(){return T()},in_draw:function(){return w>=120||M()||S()},insufficient_material:function(){return S()},in_threefold_repetition:function(){return M()},game_over:function(){return w>=120||z()||T()||S()||M()||y[Y(q)]===r},validate_fen:function(e){return P(e)},fen:function(){return E()},board:function(){let e=[],n=[];for(let t=m.a9;t<=m.i0;t++)null==v[t]?n.push(null):n.push({type:v[t].type,color:v[t].color}),8&t&&(e.push(n),n=[],t+=7);return e},pgn:function(e){let n,t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",r="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,i=[],o=!1;for(n in N)i.push("["+n+' "'+N[n]+'"]'+t),o=!0;o&&R.length&&i.push(t);let s=[];for(;R.length>0;)s.push(H());let u=[],l="";for(;s.length>0;){let e=s.pop();R.length||"b"!==e.color?"b"!==e.color&&(l.length&&u.push(l),l=A+"."):l=A+". ...",l=l+" "+B(e),D(e)}if(l.length&&u.push(l),void 0!==N.Result&&u.push(N.Result),0===r)return i.join("")+u.join(" ");let f=0;for(n=0;n<u.length;n++)f+u[n].length>r&&0!==n?(" "===i[i.length-1]&&i.pop(),i.push(t),f=0):0!==n&&(i.push(" "),f++),i.push(u[n]),f+=u[n].length;return i.join("")},load_pgn:function(e,n){let t=void 0!==n&&"sloppy"in n&&n.sloppy;function r(e){return e.replace(/\\/g,"\\")}const i="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",o=new RegExp("^(?:\\s)*(((?:"+r(i)+")*\\[[^\\]]+\\])+)"),s=o.test(e)?o.exec(e)[1]:"";O();const u=function(e,n){let t="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",i={},o=e.split(new RegExp(r(t))),s="",u="";for(let e=0;e<o.length;e++)s=o[e].replace(/^\[([A-Z][A-Za-z]*)\s.*]$/,"$1"),u=o[e].replace(/^\[[A-Za-z]+\s"(.*)"]$/,"$1"),ue(s).length>0&&(i[s]=u);return i}(s,n);for(let e in u)u.hasOwnProperty(e)&&j([e,u[e]]);if("FEN"in u&&!C(u.FEN,!0))return console.warn("load header FEN failed!"),!1;let l=e.replace(s,"").replace(new RegExp(r(i),"g")," ");l=l.replace(/({[^}]+})+?/g,"");const f=/(\([^()]+\))+?/g;for(;f.test(l);)l=l.replace(f,"");l=l.replace(/\d+\.(\.\.)?/g,""),l=l.replace(/\.\.\./g,""),l=l.replace(/\$\d+/g,"");let c=ue(l).split(new RegExp(/\s+/));c=c.join(",").replace(/,,+/g,",").split(",");let a="";for(let e=0;e<c.length-1;e++){if(a=Z(c[e],t),null==a)return console.warn(`impossible move: ${c[e]}!\n${V()}`),!1;D(a)}if(a=c[c.length-1],p.indexOf(a)>-1)(function(e){for(let n in e)if(e.hasOwnProperty(n))return!0;return!1})(N)&&void 0===N.Result&&j(["Result",a]);else{if(a=Z(a,t),null==a)return console.warn(`impossible last move: ${c[c.length-1]}!\n${V()}`),!1;D(a)}return!0},header:function(){return j(arguments)},ascii:function(){return V()},turn:function(){return q},move:function(e,n){const t=void 0!==n&&"sloppy"in n&&n.sloppy;let r=null;if("string"==typeof e)r=Z(e,t);else if("object"==typeof e){let n=U();for(let t=0,i=n.length;t<i;t++)if(e.from===W(n[t].from)&&e.to===W(n[t].to)&&!(""in n[t])){r=n[t];break}}if(!r)return null;const i=oe(r);return D(r),k=[],i},undo:function(){X(k,null);const e=H();if(e){const n=oe(e);return[e.from,e.to]=[e.to,e.from],k[k.length-1].move=e,n}return k.pop(),null},redo:function(){X(R,null);const e=G(k.pop(),!1);return e?([e.from,e.to]=[e.to,e.from],R[R.length-1].move=e,oe(e)):(R.pop(),null)},clear:function(){return _()},put:function(e,n){return I(e,n)},get:function(e){return $(e)},remove:function(e){return function(e){const n=$(e);return v[m[e]]=null,n&&n.type===c&&(y[n.color]=r),x(E()),n}(e)},perft:function(e){return le(e)},getHistory:function(){return R.map((e=>{const n=e.move;return{...n,from:W(n.from),to:W(n.to),piece:q===t?n.piece.toUpperCase():n.piece}}))},history:function(e){let n=[],t=[],r=void 0!==e&&"verbose"in e&&e.verbose;for(;R.length>0;)n.push(H());for(;n.length>0;){let e=n.pop();r?t.push(oe(e)):t.push(B(e)),D(e)}return t}}}));n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/KKCoTuongBundle', 'chunks:///_virtual/KKCoTuongBundle'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});